<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Refund Processed - {{ event_title | default('Your Event') }} - Events2Go</title>
    <!--[if mso]>
    <noscript>
        <xml>
            <o:OfficeDocumentSettings>
                <o:PixelsPerInch>96</o:PixelsPerInch>
            </o:OfficeDocumentSettings>
        </xml>
    </noscript>
    <![endif]-->
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background-color: #f7fafc;
            margin: 0;
            padding: 0;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        table {
            border-collapse: collapse;
            mso-table-lspace: 0pt;
            mso-table-rspace: 0pt;
        }

        img {
            border: 0;
            height: auto;
            line-height: 100%;
            outline: none;
            text-decoration: none;
            -ms-interpolation-mode: bicubic;
        }

        /* Container */
        .email-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #ffffff;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            padding: 40px 30px;
            text-align: center;
        }

        .logo {
            max-width: 180px;
            height: auto;
            margin-bottom: 20px;
        }

        .header-title {
            color: #ffffff;
            font-size: 28px;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Refund Section */
        .refund-section {
            background-color: #ffffff;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .refund-badge {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .refund-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .refund-subtitle {
            font-size: 16px;
            color: #718096;
        }

        /* Content */
        .content {
            padding: 40px 30px;
            background-color: #ffffff;
        }

        .greeting {
            font-size: 18px;
            color: #2d3748;
            margin-bottom: 25px;
        }

        .message {
            font-size: 16px;
            color: #4a5568;
            line-height: 1.7;
            margin-bottom: 30px;
        }

        /* Refund Details */
        .refund-details {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border: 1px solid #4fd1c7;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }

        .refund-details-title {
            font-size: 20px;
            font-weight: 700;
            color: #234e52;
            margin-bottom: 25px;
            text-align: center;
        }

        .refund-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .refund-info-item {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #4fd1c7;
            text-align: center;
        }

        .refund-info-label {
            font-size: 12px;
            color: #234e52;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .refund-info-value {
            font-size: 18px;
            font-weight: 700;
            color: #234e52;
        }

        .refund-amount {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
            border: 2px solid #48bb78;
        }

        .refund-amount .refund-info-value {
            font-size: 32px;
            color: #22543d;
        }

        /* Transaction Details */
        .transaction-details {
            background-color: #f8fafc;
            border-left: 4px solid #48bb78;
            border-radius: 0 12px 12px 0;
            padding: 25px;
            margin: 30px 0;
        }

        .transaction-title {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .transaction-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .transaction-label {
            font-size: 14px;
            color: #4a5568;
            font-weight: 500;
        }

        .transaction-value {
            font-size: 14px;
            color: #2d3748;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        /* Timeline */
        .timeline {
            background: linear-gradient(135deg, #fef5e7 0%, #fdf2e9 100%);
            border: 1px solid #f6ad55;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }

        .timeline-title {
            font-size: 18px;
            font-weight: 700;
            color: #744210;
            margin-bottom: 20px;
            text-align: center;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 35px;
            width: 2px;
            height: calc(100% + 5px);
            background: #f6ad55;
        }

        .timeline-item:last-child::before {
            display: none;
        }

        .timeline-icon {
            width: 30px;
            height: 30px;
            background: #f6ad55;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            margin-right: 20px;
            flex-shrink: 0;
            z-index: 1;
            position: relative;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-step {
            font-size: 16px;
            font-weight: 600;
            color: #744210;
            margin-bottom: 5px;
        }

        .timeline-desc {
            font-size: 14px;
            color: #744210;
            line-height: 1.5;
        }

        /* Important Notes */
        .important-notes {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border: 1px solid #4fd1c7;
            border-radius: 16px;
            padding: 25px;
            margin: 30px 0;
        }

        .notes-title {
            font-size: 16px;
            font-weight: 600;
            color: #234e52;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .notes-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        .notes-list {
            list-style: none;
            padding: 0;
        }

        .notes-list li {
            font-size: 14px;
            color: #234e52;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .notes-list li:before {
            content: "ℹ️";
            position: absolute;
            left: 0;
        }

        /* Action Buttons */
        .action-buttons {
            text-align: center;
            margin: 40px 0;
        }

        .btn {
            display: inline-block;
            padding: 16px 32px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            margin: 0 10px 10px 0;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: #ffffff !important;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6);
        }

        .btn-secondary {
            background: #ffffff;
            color: #48bb78 !important;
            border: 2px solid #48bb78;
        }

        .btn-secondary:hover {
            background: #48bb78;
            color: #ffffff !important;
        }

        /* Footer */
        .footer {
            background-color: #2d3748;
            color: #a0aec0;
            padding: 40px 30px;
            text-align: center;
        }

        .footer-content {
            margin-bottom: 20px;
        }

        .footer-title {
            color: #ffffff;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .footer-text {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .footer-links {
            margin: 20px 0;
        }

        .footer-link {
            color: #48bb78;
            text-decoration: none;
            margin: 0 15px;
            font-size: 14px;
        }

        .footer-link:hover {
            color: #ffffff;
        }

        .footer-bottom {
            border-top: 1px solid #4a5568;
            padding-top: 20px;
            font-size: 12px;
            color: #718096;
        }

        /* Responsive */
        @media only screen and (max-width: 600px) {
            .email-container {
                width: 100% !important;
            }

            .header, .refund-section, .content, .footer {
                padding-left: 20px !important;
                padding-right: 20px !important;
            }

            .refund-info-grid {
                grid-template-columns: 1fr !important;
            }

            .transaction-item {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 5px !important;
            }

            .btn {
                display: block !important;
                margin: 10px 0 !important;
            }

            .timeline-item {
                flex-direction: column !important;
                align-items: flex-start !important;
            }

            .timeline-icon {
                margin-bottom: 10px !important;
                margin-right: 0 !important;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .email-container {
                background-color: #1a202c !important;
            }

            .content, .refund-section, .transaction-details, .refund-info-item {
                background-color: #2d3748 !important;
            }

            .refund-title, .greeting, .transaction-title, .refund-info-value {
                color: #ffffff !important;
            }

            .message, .refund-subtitle, .transaction-label, .refund-info-label {
                color: #a0aec0 !important;
            }

            .transaction-value {
                color: #ffffff !important;
            }

            .transaction-item {
                border-color: #4a5568 !important;
            }
        }
    </style>
</head>
<body>
    <div class="email-container">
        <!-- Header -->
        <div class="header">
            {% if logo_url %}
            <img src="{{ logo_url }}" alt="Events2Go Logo" class="logo">
            {% else %}
            <img src="/media/events2go-gradient-logo.png" alt="Events2Go Logo" class="logo">
            {% endif %}
            <h1 class="header-title">Refund Processed</h1>
        </div>

        <!-- Refund Section -->
        <div class="refund-section">
            <div class="refund-badge">💰</div>
            <h2 class="refund-title">Your Refund is Complete</h2>
            <p class="refund-subtitle">The refund has been processed successfully</p>
        </div>

        <!-- Content -->
        <div class="content">
            <p class="greeting">Hello <strong>{{ username }}</strong>,</p>

            <p class="message">
                Great news! Your refund request has been processed successfully. The refund amount will appear in your 
                original payment method within the timeframe specified below.
            </p>

            <!-- Refund Details -->
            <div class="refund-details">
                <h3 class="refund-details-title">Refund Summary</h3>
                <div class="refund-info-grid">
                    <div class="refund-info-item refund-amount">
                        <div class="refund-info-label">Refund Amount</div>
                        <div class="refund-info-value">{{ refund_amount }}</div>
                    </div>
                    <div class="refund-info-item">
                        <div class="refund-info-label">Refund Method</div>
                        <div class="refund-info-value">{{ refund_method | default('Original Payment Method') }}</div>
                    </div>
                    <div class="refund-info-item">
                        <div class="refund-info-label">Processing Time</div>
                        <div class="refund-info-value">{{ processing_time | default('3-5 Business Days') }}</div>
                    </div>
                    {% if event_title %}
                    <div class="refund-info-item">
                        <div class="refund-info-label">Event</div>
                        <div class="refund-info-value">{{ event_title }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Transaction Details -->
            <div class="transaction-details">
                <h3 class="transaction-title">Transaction Details</h3>
                {% if refund_id %}
                <div class="transaction-item">
                    <span class="transaction-label">Refund ID:</span>
                    <span class="transaction-value">{{ refund_id }}</span>
                </div>
                {% endif %}
                {% if original_transaction_id %}
                <div class="transaction-item">
                    <span class="transaction-label">Original Transaction:</span>
                    <span class="transaction-value">{{ original_transaction_id }}</span>
                </div>
                {% endif %}
                {% if booking_id %}
                <div class="transaction-item">
                    <span class="transaction-label">Booking Reference:</span>
                    <span class="transaction-value">{{ booking_id }}</span>
                </div>
                {% endif %}
                <div class="transaction-item">
                    <span class="transaction-label">Refund Date:</span>
                    <span class="transaction-value">{{ refund_date | default('Today') }}</span>
                </div>
                {% if original_amount %}
                <div class="transaction-item">
                    <span class="transaction-label">Original Amount:</span>
                    <span class="transaction-value">{{ original_amount }}</span>
                </div>
                {% endif %}
                {% if refund_fee %}
                <div class="transaction-item">
                    <span class="transaction-label">Processing Fee:</span>
                    <span class="transaction-value">{{ refund_fee }}</span>
                </div>
                {% endif %}
            </div>

            <!-- Timeline -->
            <div class="timeline">
                <h3 class="timeline-title">What Happens Next</h3>
                <div class="timeline-item">
                    <div class="timeline-icon">✓</div>
                    <div class="timeline-content">
                        <div class="timeline-step">Refund Approved</div>
                        <div class="timeline-desc">Your refund request has been reviewed and approved</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon">⏳</div>
                    <div class="timeline-content">
                        <div class="timeline-step">Processing</div>
                        <div class="timeline-desc">The refund is being processed by our payment provider</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon">💳</div>
                    <div class="timeline-content">
                        <div class="timeline-step">Refund Appears</div>
                        <div class="timeline-desc">The amount will appear in your account within {{ processing_time | default('3-5 business days') }}</div>
                    </div>
                </div>
            </div>

            <!-- Important Notes -->
            <div class="important-notes">
                <h3 class="notes-title">
                    <span class="notes-icon">📋</span>
                    Important Information
                </h3>
                <ul class="notes-list">
                    <li>The refund will appear on the same payment method used for the original purchase</li>
                    <li>Processing times may vary depending on your bank or card issuer</li>
                    <li>You will receive a separate confirmation from your bank when the refund is credited</li>
                    {% if refund_reason %}
                    <li>Refund reason: {{ refund_reason }}</li>
                    {% endif %}
                    <li>Keep this email as proof of your refund for your records</li>
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                {% if dashboard_url %}
                <a href="{{ dashboard_url }}" class="btn btn-primary">View Dashboard</a>
                {% endif %}
                {% if receipt_url %}
                <a href="{{ receipt_url }}" class="btn btn-secondary">Download Receipt</a>
                {% endif %}
                {% if support_url %}
                <a href="{{ support_url }}" class="btn btn-secondary">Contact Support</a>
                {% endif %}
            </div>

            <p class="message">
                If you have any questions about your refund or don't see the amount in your account after the expected 
                timeframe, please don't hesitate to contact our support team. We're here to help!
            </p>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-content">
                <h3 class="footer-title">Events2Go</h3>
                <p class="footer-text">Thank you for choosing Events2Go</p>

                <div class="footer-links">
                    <a href="#" class="footer-link">My Account</a>
                    <a href="#" class="footer-link">Help Center</a>
                    <a href="#" class="footer-link">Contact Support</a>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; {{ year }} Events2Go. All rights reserved.</p>
                <p>This is your official refund confirmation.</p>
            </div>
        </div>
    </div>
</body>
</html>